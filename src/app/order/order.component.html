<ion-content>
    <section class="section-name padding-y-sm">
        <div class="container animate main">
            <div class="row align-top">
                <div class="col-12">
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a [routerLink]="['/']">Home</a></li>
                            <li class="breadcrumb-item"><a [routerLink]="['/card', id]">{{card?.name}}</a></li>
                            <li class="breadcrumb-item active" aria-current="page">Order</li>
                        </ol>
                    </nav>
                </div>
                <div class="col-lg-6 col-sm-12">
                    <!--<button (click)="test(confimation)">test</button>-->
                    <app-imagegrid id="{{id}}"></app-imagegrid>
                    <app-add-more *ngIf="card" [id]="card!.id" [recipients]="card!.recipients" [limit]=4 (selectedChange)="addMoreChange($event)"></app-add-more>
                </div>
                <div class="col-lg-6 col-sm-12 row" *ngIf="card != undefined">
                    <div class="col-12">
                        <header class="section-heading">
                            <div class="header">
                                <h3 class="section-title">{{card?.name}}</h3>
                                <h6 class="card-subtitle mb-2 text-muted" *ngFor="let type of card?.types">{{type}}</h6>
                            </div>
                        </header>
                    </div>
                    <div class="col-12">
                        <p>{{card?.description}}</p>
                    </div>
                    <div class="col-6 mb-2">
                        <h5 class="section-title" *ngIf="card">â‚±{{card?.price | number:'1.2-2'}}</h5>
                    </div>
                    <div class="col-6 mb-2 text-right">
                        <button class="btn btn-light inst-but" (click)="showInstruction()">{{card!.signAndSend?'How to do Sign & Send':'How to Buy'}}</button>
                    </div>
                    <div class="col-12 mb-2">
                        <span class="text-muted">Sender</span>
                    </div>

                    <form [formGroup]="form" (ngSubmit)="addToCart(confimation)">
                        <div class="col-12 mb-2">
                            <label class="form-label">* Sender Name</label>
                            <span class="instruction" *ngIf="instruction">Insert Name of the Buyer</span>
                            <input type="text" class="form-control" formControlName="sender_name" placeholder="Name" [ngClass]="{ 'is-invalid': submitted && controls()['sender_name'].errors}">
                            <div *ngIf="submitted && controls()['sender_name'].errors" class="invalid-feedback">
                                <div *ngIf="controls()['sender_name'].errors!['required']">Sender name is required</div>
                                <div *ngIf="controls()['sender_name'].errors!['maxlength']">Sender name must not exceed 50 characters</div>
                            </div>
                        </div>
                        <div class="col-12 mb-2">
                            <label class="form-label">* Sender Phone Number</label>
                            <span class="instruction" *ngIf="instruction">Insert Phone number of the Buyer</span>
                            <input type="text" class="form-control" formControlName="sender_phone" placeholder="Phone Number" [ngClass]="{ 'is-invalid': submitted && controls()['sender_phone'].errors}">
                            <div *ngIf="submitted && controls()['sender_phone'].errors" class="invalid-feedback">
                                <div *ngIf="controls()['sender_phone'].errors!['required']">Sender phone is required</div>
                                <div *ngIf="controls()['sender_phone'].errors!['maxlength']">Sender phone must not exceed 20 characters</div>
                            </div>
                        </div>
                        <div class="col-12 mb-2">
                            <label class="form-label">* Sender Email Address</label>
                            <span class="instruction" *ngIf="instruction">Insert Valid Email Address of the Buyer</span>
                            <input type="email" class="form-control" formControlName="sender_email" placeholder="Email Address" [ngClass]="{ 'is-invalid': submitted && controls()['sender_email'].errors}">
                            <div *ngIf="submitted && controls()['sender_email'].errors" class="invalid-feedback">
                                <div *ngIf="controls()['sender_email'].errors!['required']">Sender email address is required</div>
                                <div *ngIf="controls()['sender_email'].errors!['email']">Invalid email address</div>
                            </div>
                        </div>
                        <div class="col-12 mb-2">
                            <span class="text-muted">Recipient</span>
                        </div>
                        <div class="col-12 mb-2">
                            <label class="form-label">* Recipient Name</label>
                            <span class="instruction" *ngIf="instruction">Insert Name of the Receiver</span>
                            <input type="text" class="form-control" formControlName="receiver_name" placeholder="Name" [ngClass]="{ 'is-invalid': submitted && controls()['receiver_name'].errors}">
                            <div *ngIf="submitted && controls()['receiver_name'].errors" class="invalid-feedback">
                                <div *ngIf="controls()['receiver_name'].errors!['required']">Receiver name is required</div>
                                <div *ngIf="controls()['receiver_name'].errors!['maxlength']">Receiver name must not exceed 50 characters</div>
                            </div>
                        </div>
                        <div class="col-12 mb-2">
                            <label class="form-label">* Recipient Phone Number</label>
                            <span class="instruction" *ngIf="instruction">Insert Phone Number of the Receiver</span>
                            <input type="text" class="form-control" formControlName="receiver_phone" placeholder="Phone Number" [ngClass]="{ 'is-invalid': submitted && controls()['receiver_phone'].errors}">
                            <div *ngIf="submitted && controls()['receiver_phone'].errors" class="invalid-feedback">
                                <div *ngIf="controls()['receiver_phone'].errors!['required']">Receiver phone is required</div>
                                <div *ngIf="controls()['receiver_phone'].errors!['maxlength']">Receiver phone must not exceed 20 characters</div>
                            </div>
                        </div>
                        <div class="col-12 mb-2">
                            <label class="form-label">* Recipient Email Address</label>
                            <span class="instruction" *ngIf="instruction">Insert Valid Email Address of the Receiver</span>
                            <input type="email" class="form-control" formControlName="receiver_email" placeholder="Email Address" [ngClass]="{ 'is-invalid': submitted && controls()['receiver_email'].errors}">
                            <div *ngIf="submitted && controls()['receiver_email'].errors" class="invalid-feedback">
                                <div *ngIf="controls()['receiver_email'].errors!['required']">Receiver email address is required</div>
                                <div *ngIf="controls()['receiver_email'].errors!['email']">Invalid email address</div>
                            </div>
                        </div>
                        <div class="col-12 mb-2">
                            <span class="text-muted">Delivery Address</span>
                            <span class="instruction" *ngIf="instruction">Insert Delivery Address of the Buyer or Receiver</span>
                        </div>
                        <div class="col-12 mb-2">
                            <label class="form-label">* Address 1</label>
                            <input type="text" class="form-control" formControlName="address1" placeholder="Address" [ngClass]="{ 'is-invalid': submitted && controls()['address1'].errors}">
                            <div *ngIf="submitted && controls()['address1'].errors" class="invalid-feedback">
                                <div *ngIf="controls()['address1'].errors!['required']">Address is required</div>
                                <div *ngIf="controls()['address1'].errors!['maxlength']">Address must not exceed 50 characters</div>
                            </div>
                        </div>
                        <div class="col-12 mb-2">
                            <label class="form-label">* Address 2</label>
                            <input type="text" class="form-control" formControlName="address2" placeholder="Address" [ngClass]="{ 'is-invalid': submitted && controls()['address2'].errors}">
                            <div *ngIf="submitted && controls()['address2'].errors" class="invalid-feedback">
                                <div *ngIf="controls()['address2'].errors!['required']">Address is required</div>
                                <div *ngIf="controls()['address2'].errors!['maxlength']">Address must not exceed 50 characters</div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-6 mb-2">
                                <label class="form-label">* Province/Region</label>
                                <input type="text" class="form-control" formControlName="province" placeholder="Province/Region" list="provinceIds" [ngClass]="{ 'is-invalid': submitted && controls()['province'].errors}" (change)="proviceChange($event)">
                                <div *ngIf="submitted && controls()['province'].errors" class="invalid-feedback">
                                    <div *ngIf="controls()['province'].errors!['required']">Province/Region is required</div>
                                    <div *ngIf="controls()['province'].errors!['maxlength']">Province/Region must not exceed 50 characters</div>
                                </div>
                                <datalist id="provinceIds">
                                    <option *ngFor="let item of addressConfig" value="{{item.name}}">{{item.name}}</option>
                                </datalist>
                            </div>
                            <div class="col-6 mb-2">
                                <label class="form-label">* City/Municipality</label>
                                <input type="text" class="form-control" formControlName="city" placeholder="City/Municipality" list="cityIds" [ngClass]="{ 'is-invalid': submitted && controls()['city'].errors}">
                                <div *ngIf="submitted && controls()['city'].errors" class="invalid-feedback">
                                    <div *ngIf="controls()['city'].errors!['required']">City/Municipality is required</div>
                                    <div *ngIf="controls()['city'].errors!['maxlength']">City/Municipality must not exceed 50 characters</div>
                                </div>
                                <datalist id="cityIds">
                                    <option *ngFor="let city of cities" value="{{city}}">{{city}}</option>
                                </datalist>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-6 mb-2">
                                <label class="form-label">* Country</label>
                                <input type="text" class="form-control" formControlName="country" placeholder="Country" [ngClass]="{ 'is-invalid': submitted && controls()['country'].errors}">
                                <div *ngIf="submitted && controls()['country'].errors" class="invalid-feedback">
                                    <div *ngIf="controls()['country'].errors!['required']">Country is required</div>
                                    <div *ngIf="controls()['country'].errors!['maxlength']">Country must not exceed 50 characters</div>
                                </div>
                            </div>
                            <div class="col-6 mb-2">
                                <label class="form-label">* Postcode</label>
                                <input type="text" class="form-control" formControlName="postcode" placeholder="Postcode" [ngClass]="{ 'is-invalid': submitted && controls()['postcode'].errors}">
                                <div *ngIf="submitted && controls()['postcode'].errors" class="invalid-feedback">
                                    <div *ngIf="controls()['postcode'].errors!['required']">Postcode is required</div>
                                    <div *ngIf="controls()['postcode'].errors!['maxlength']">Postcode must not exceed 20 characters</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-12 mb-2 mt-2 pl-3 form-check">
                            <input type="checkbox" class="form-check-input" formControlName="anonymously">
                            <label class="form-check-label">Send Anonymously</label>
                            <span class="instruction" *ngIf="instruction">Check the Box if you want to send Anonymously</span>
                        </div>
                        <div class="col-12 mb-2">
                            <label class="form-label">Send To</label>
                            <span class="instruction" *ngIf="instruction">or you want to choose between Recipient (Receiver) or Sender (Buyer)</span>
                            <select class="form-select form-control" formControlName="sendto">
                                <option selected value="Recipient">Recipient</option>
                                <option value="Sender">Sender</option>
                            </select>
                        </div>
                        <div class="col-12 mb-2" *ngIf="card?.signAndSend">
                            <span class="instruction" *ngIf="instruction">then Click Sign & Send</span>
                            <app-sign-and-send (signAndSendEvent)="receiveSignAndSend($event)"></app-sign-and-send>
                        </div>
                        <div class="col-12 mb-2" *ngIf="!card?.signAndSend">
                            <label class="form-label">Personal Message</label>
                            <span class="instruction" *ngIf="instruction">Insert Personal Message (Optional)</span>
                            <textarea class="form-control" placeholder="Personal Message" rows="5" formControlName="message"></textarea>
                        </div>
                        <div class="col-12 mt-2">
                            <button class="btn btn-primary full-size" type="submit">Add to Cart</button>
                        </div>
                    </form>
                </div>
            </div>

            <ng-template #confimation let-modal>
                <div class="modal-header">
                    <h4 class="modal-title" id="modal-basic-title">{{totalCount}} item added</h4>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-2"><img src="{{primaryImageURL}}"></div>
                        <div class="col-7">
                            <label>{{card?.name}}</label><br />
                            <label>Shipping Fee</label>
                        </div>
                        <div class="col-3 allign-right">
                            <label *ngIf="card">{{card.primary| number:'1.2-2'}}</label><br />
                            <label>{{shippingfee! > 0?(shippingfee| number:'1.2-2'):'Free'}}</label>
                        </div>
                    </div>
                    <div class="border"></div>
                    <div *ngFor="let item of addMore">
                        <div class="row" *ngIf="item.count > 0">
                            <div class="col-2"></div>
                            <div class="col-8">
                                <label>{{item.card.name}}</label><br />
                                <label>Shipping Fee</label>
                            </div>
                            <div class="col-2 allign-right">
                                <label>{{item.card.price! * item.count!| number:'1.2-2'}}</label><br />
                                <label>{{item.shipping_fee! > 0?(item.shipping_fee| number:'1.2-2'):'Free'}}</label>
                            </div>
                        </div>
                        <div class="border" *ngIf="item.count > 0"></div>
                    </div>
                    <div class="row">
                        <div class="col-6"><strong>Total:</strong></div>
                        <div class="col-6">
                            <div class="col-12 allign-right"><strong>â‚± {{total | number:'1.2-2'}}</strong></div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer footer">
                    <button class="btn btn-link" (click)="keepShopping()">Keep Shopping</button>
                    <button class="btn btn-primary" ngbAutofocus (click)="cart()">VIEW CART</button>
                </div>
            </ng-template>
        </div>
    </section>
    <app-footer></app-footer>
</ion-content>